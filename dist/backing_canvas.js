"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.backingCanvas = void 0;
exports.backingCanvas = (() => {
    let cellularAutomaton = "Conway";
    let shouldWrap = true;
    let shouldTrace = true;
    const getAlgorithmColorMap = (input) => {
        if (input === undefined || input === null)
            input = cellularAutomaton;
        switch (input) {
            case "Conway":
                return {
                    "-1": "#696969",
                    1: "#FFFFFF" //white
                };
            default:
                throw "Invalid automaton!";
        }
    };
    return {
        setAlgorithm: (input) => {
            cellularAutomaton = input;
        },
        getShouldWrap: () => shouldWrap,
        setShouldWrap: (input) => {
            shouldWrap = input;
        },
        setShouldTrace: (input) => {
            shouldTrace = input;
        },
        getNextState: (state) => {
            const genEmptyArray = (x, y) => {
                const array = Array.from(Array(y), () => new Array(x));
                array.forEach((line) => line.fill(0));
                return array;
            };
            const conway = (state) => {
                //#region without wrap around
                const getNearbyPopulationNoWrap = (x, y) => {
                    const maxY = state.length - 1;
                    const maxX = state[0].length - 1;
                    const isUnderMinY = y - 1 < 0;
                    const isUnderMinX = x - 1 < 0;
                    const isOverMaxY = y + 1 > maxY;
                    const isOverMaxX = x + 1 > maxX;
                    let numOfLiveCells = 0;
                    //top left
                    if (!isUnderMinY && !isUnderMinX && state[y - 1][x - 1] === 1)
                        numOfLiveCells++;
                    //top
                    if (!isUnderMinY && state[y - 1][x])
                        numOfLiveCells++;
                    //top right
                    if (!isUnderMinY && !isOverMaxX && state[y - 1][x + 1] === 1)
                        numOfLiveCells++;
                    //right
                    if (!isOverMaxX && state[y][x + 1])
                        numOfLiveCells++;
                    //bottom right
                    if (!isOverMaxY && !isOverMaxX && state[y + 1][x + 1] === 1)
                        numOfLiveCells++;
                    //bottom
                    if (!isOverMaxY && state[y + 1][x])
                        numOfLiveCells++;
                    //bottom left
                    if (!isOverMaxY && !isUnderMinX && state[y + 1][x - 1] === 1)
                        numOfLiveCells++;
                    //left
                    if (!isOverMaxX && state[y][x - 1] === 1)
                        numOfLiveCells++;
                    return numOfLiveCells;
                };
                //#endregion end wrap around
                //#region wrap around
                const wrap = (number, max) => ((number % max) + max) % max;
                const getNearbyPopulationWrap = (x, y) => {
                    const maxY = state.length;
                    const maxX = state[0].length;
                    let numOfLiveCells = 0;
                    //top left
                    if (state[wrap(y - 1, maxY)][wrap(x - 1, maxX)] === 1)
                        numOfLiveCells++;
                    //top
                    if (state[wrap(y - 1, maxY)][x] === 1)
                        numOfLiveCells++;
                    //top right
                    if (state[wrap(y - 1, maxY)][wrap(x + 1, maxX)] === 1)
                        numOfLiveCells++;
                    //right
                    if (state[y][wrap(x + 1, maxX)] === 1)
                        numOfLiveCells++;
                    //bottom right
                    if (state[wrap(y + 1, maxY)][wrap(x + 1, maxX)] === 1)
                        numOfLiveCells++;
                    //bottom
                    if (state[wrap(y + 1, maxY)][x] === 1)
                        numOfLiveCells++;
                    //bottom left
                    if (state[wrap(y + 1, maxY)][wrap(x - 1, maxX)] === 1)
                        numOfLiveCells++;
                    //left
                    if (state[y][wrap(x - 1, maxX)] === 1)
                        numOfLiveCells++;
                    return numOfLiveCells;
                };
                //#endregion wrap around
                const nextState = genEmptyArray(state[0].length, state.length);
                for (let y = 0; y < state.length; y++) {
                    for (let x = 0; x < state[0].length; x++) {
                        const ogPop = state[y][x];
                        const numOfLiveCellsNearby = shouldWrap ? getNearbyPopulationWrap(x, y) : getNearbyPopulationNoWrap(x, y);
                        let newPop;
                        if (ogPop === 0 || ogPop === -1) //if the cell is dead
                            newPop = (numOfLiveCellsNearby === 3) ? 1 : 0;
                        else if (ogPop === 1) //if the cell is live
                            newPop = (numOfLiveCellsNearby === 2 || numOfLiveCellsNearby === 3) ? 1 : 0;
                        if (shouldTrace && newPop === 0 && (ogPop === -1 || ogPop === 1))
                            newPop = -1;
                        nextState[y][x] = newPop;
                    }
                }
                const stateDataMap = {
                    data: nextState,
                    map: getAlgorithmColorMap("Conway"),
                    traceNumber: shouldTrace ? -1 : null
                };
                return stateDataMap;
            };
            switch (cellularAutomaton) {
                case "Conway":
                default:
                    return conway(state);
            }
        },
        getAlgorithmColorMap: getAlgorithmColorMap
    };
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2luZ19jYW52YXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvYmFja2luZ19jYW52YXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQWEsUUFBQSxhQUFhLEdBQUcsQ0FBQyxHQU81QixFQUFFO0lBRUEsSUFBSSxpQkFBaUIsR0FBZ0MsUUFBUSxDQUFDO0lBQzlELElBQUksVUFBVSxHQUFHLElBQUksQ0FBQztJQUN0QixJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUM7SUFFdkIsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLEtBQW1DLEVBQVksRUFBRTtRQUUzRSxJQUFJLEtBQUssS0FBSyxTQUFTLElBQUksS0FBSyxLQUFLLElBQUk7WUFDckMsS0FBSyxHQUFHLGlCQUFpQixDQUFDO1FBRTlCLFFBQVEsS0FBSyxFQUFFO1lBRVgsS0FBSyxRQUFRO2dCQUNULE9BQU87b0JBQ0gsSUFBSSxFQUFFLFNBQVM7b0JBQ2YsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxPQUFPO2lCQUN2QixDQUFDO1lBQ047Z0JBQ0ksTUFBTSxvQkFBb0IsQ0FBQztTQUVsQztJQUVMLENBQUMsQ0FBQztJQUVGLE9BQU87UUFFSCxZQUFZLEVBQUUsQ0FBQyxLQUFrQyxFQUFRLEVBQUU7WUFDdkQsaUJBQWlCLEdBQUcsS0FBSyxDQUFDO1FBQzlCLENBQUM7UUFDRCxhQUFhLEVBQUUsR0FBWSxFQUFFLENBQUMsVUFBVTtRQUN4QyxhQUFhLEVBQUUsQ0FBQyxLQUFjLEVBQVEsRUFBRTtZQUNwQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLENBQUM7UUFDRCxjQUFjLEVBQUUsQ0FBQyxLQUFjLEVBQVEsRUFBRTtZQUNyQyxXQUFXLEdBQUcsS0FBSyxDQUFDO1FBQ3hCLENBQUM7UUFDRCxZQUFZLEVBQUUsQ0FBQyxLQUFpQixFQUFTLEVBQUU7WUFFdkMsTUFBTSxhQUFhLEdBQUcsQ0FBQyxDQUFTLEVBQUUsQ0FBUyxFQUFjLEVBQUU7Z0JBRXZELE1BQU0sS0FBSyxH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LENBQUMsQ0FBQzthQUU1QjtRQUVMLENBQUM7UUFDRCxvQkFBb0IsRUFBRSxvQkFBb0I7S0FFN0MsQ0FBQztBQUVOLENBQUMsQ0FBQyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgYmFja2luZ0NhbnZhcyA9ICgoKToge1xyXG4gICAgc2V0QWxnb3JpdGhtOiAoaW5wdXQ6IENlbGx1bGFyQXV0b21hdGFEaXNwbGF5TmFtZSkgPT4gdm9pZDtcclxuICAgIGdldFNob3VsZFdyYXA6ICgpID0+IGJvb2xlYW47XHJcbiAgICBzZXRTaG91bGRXcmFwOiAoaW5wdXQ6IGJvb2xlYW4pID0+IHZvaWQ7XHJcbiAgICBzZXRTaG91bGRUcmFjZTogKGlucHV0OiBib29sZWFuKSA9PiB2b2lkO1xyXG4gICAgZ2V0TmV4dFN0YXRlOiAoc3RhdGU6IG51bWJlcltdW10pID0+IFN0YXRlO1xyXG4gICAgZ2V0QWxnb3JpdGhtQ29sb3JNYXA6IChpbnB1dD86IENlbGx1bGFyQXV0b21hdGFEaXNwbGF5TmFtZSkgPT4gQ29sb3JNYXA7XHJcbn0gPT4ge1xyXG5cclxuICAgIGxldCBjZWxsdWxhckF1dG9tYXRvbjogQ2VsbHVsYXJBdXRvbWF0YURpc3BsYXlOYW1lID0gXCJDb253YXlcIjtcclxuICAgIGxldCBzaG91bGRXcmFwID0gdHJ1ZTtcclxuICAgIGxldCBzaG91bGRUcmFjZSA9IHRydWU7XHJcblxyXG4gICAgY29uc3QgZ2V0QWxnb3JpdGhtQ29sb3JNYXAgPSAoaW5wdXQ/OiBDZWxsdWxhckF1dG9tYXRhRGlzcGxheU5hbWUpOiBDb2xvck1hcCA9PiB7XHJcblxyXG4gICAgICAgIGlmIChpbnB1dCA9PT0gdW5kZWZpbmVkIHx8IGlucHV0ID09PSBudWxsKVxyXG4gICAgICAgICAgICBpbnB1dCA9IGNlbGx1bGFyQXV0b21hdG9uO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGlucHV0KSB7XHJcblxyXG4gICAgICAgICAgICBjYXNlIFwiQ29ud2F5XCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiLTFcIjogXCIjNjk2OTY5XCIsIC8vZGltZ3JleVxyXG4gICAgICAgICAgICAgICAgICAgIDE6IFwiI0ZGRkZGRlwiIC8vd2hpdGVcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcIkludmFsaWQgYXV0b21hdG9uIVwiO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG5cclxuICAgICAgICBzZXRBbGdvcml0aG06IChpbnB1dDogQ2VsbHVsYXJBdXRvbWF0YURpc3BsYXlOYW1lKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgIGNlbGx1bGFyQXV0b21hdG9uID0gaW5wdXQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXRTaG91bGRXcmFwOiAoKTogYm9vbGVhbiA9PiBzaG91bGRXcmFwLFxyXG4gICAgICAgIHNldFNob3VsZFdyYXA6IChpbnB1dDogYm9vbGVhbik6IHZvaWQgPT4ge1xyXG4gICAgICAgICAgICBzaG91bGRXcmFwID0gaW5wdXQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRTaG91bGRUcmFjZTogKGlucHV0OiBib29sZWFuKTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgIHNob3VsZFRyYWNlID0gaW5wdXQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXROZXh0U3RhdGU6IChzdGF0ZTogbnVtYmVyW11bXSk6IFN0YXRlID0+IHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGdlbkVtcHR5QXJyYXkgPSAoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBudW1iZXJbXVtdID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBhcnJheSA9IEFycmF5LmZyb20oQXJyYXk8QXJyYXk8bnVtYmVyPj4oeSksICgpID0+IG5ldyBBcnJheTxudW1iZXI+KHgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBhcnJheS5mb3JFYWNoKChsaW5lKSA9PiBsaW5lLmZpbGwoMCkpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBhcnJheTtcclxuXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjb253YXkgPSAoc3RhdGU6IG51bWJlcltdW10pOiBTdGF0ZSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8jcmVnaW9uIHdpdGhvdXQgd3JhcCBhcm91bmRcclxuICAgICAgICAgICAgICAgIGNvbnN0IGdldE5lYXJieVBvcHVsYXRpb25Ob1dyYXAgPSAoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBudW1iZXIgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhZID0gc3RhdGUubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhYID0gc3RhdGVbMF0ubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1VuZGVyTWluWSA9IHkgLSAxIDwgMDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1VuZGVyTWluWCA9IHggLSAxIDwgMDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc092ZXJNYXhZID0geSArIDEgPiBtYXhZO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzT3Zlck1heFggPSB4ICsgMSA+IG1heFg7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG51bU9mTGl2ZUNlbGxzID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy90b3AgbGVmdFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNVbmRlck1pblkgJiYgIWlzVW5kZXJNaW5YICYmIHN0YXRlW3kgLSAxXVt4IC0gMV0gPT09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mTGl2ZUNlbGxzKys7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vdG9wXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1VuZGVyTWluWSAmJiBzdGF0ZVt5IC0gMV1beF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mTGl2ZUNlbGxzKys7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vdG9wIHJpZ2h0XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1VuZGVyTWluWSAmJiAhaXNPdmVyTWF4WCAmJiBzdGF0ZVt5IC0gMV1beCArIDFdID09PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZkxpdmVDZWxscysrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL3JpZ2h0XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc092ZXJNYXhYICYmIHN0YXRlW3ldW3ggKyAxXSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZMaXZlQ2VsbHMrKztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9ib3R0b20gcmlnaHRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzT3Zlck1heFkgJiYgIWlzT3Zlck1heFggJiYgc3RhdGVbeSArIDFdW3ggKyAxXSA9PT0gMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZMaXZlQ2VsbHMrKztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9ib3R0b21cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzT3Zlck1heFkgJiYgc3RhdGVbeSArIDFdW3hdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZkxpdmVDZWxscysrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2JvdHRvbSBsZWZ0XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc092ZXJNYXhZICYmICFpc1VuZGVyTWluWCAmJiBzdGF0ZVt5ICsgMV1beCAtIDFdID09PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZkxpdmVDZWxscysrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2xlZnRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzT3Zlck1heFggJiYgc3RhdGVbeV1beCAtIDFdID09PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZkxpdmVDZWxscysrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVtT2ZMaXZlQ2VsbHM7XHJcblxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIC8vI2VuZHJlZ2lvbiBlbmQgd3JhcCBhcm91bmRcclxuXHJcbiAgICAgICAgICAgICAgICAvLyNyZWdpb24gd3JhcCBhcm91bmRcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdyYXAgPSAobnVtYmVyOiBudW1iZXIsIG1heDogbnVtYmVyKTogbnVtYmVyID0+ICgobnVtYmVyICUgbWF4KSArIG1heCkgJSBtYXg7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgZ2V0TmVhcmJ5UG9wdWxhdGlvbldyYXAgPSAoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBudW1iZXIgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhZID0gc3RhdGUubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFggPSBzdGF0ZVswXS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG51bU9mTGl2ZUNlbGxzID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy90b3AgbGVmdFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZVt3cmFwKHkgLSAxLCBtYXhZKV1bd3JhcCh4IC0gMSwgbWF4WCldID09PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZkxpdmVDZWxscysrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL3RvcFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZVt3cmFwKHkgLSAxLCBtYXhZKV1beF0gPT09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mTGl2ZUNlbGxzKys7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vdG9wIHJpZ2h0XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlW3dyYXAoeSAtIDEsIG1heFkpXVt3cmFwKHggKyAxLCBtYXhYKV0gPT09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mTGl2ZUNlbGxzKys7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vcmlnaHRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGVbeV1bd3JhcCh4ICsgMSwgbWF4WCldID09PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZkxpdmVDZWxscysrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2JvdHRvbSByaWdodFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZVt3cmFwKHkgKyAxLCBtYXhZKV1bd3JhcCh4ICsgMSwgbWF4WCldID09PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1PZkxpdmVDZWxscysrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2JvdHRvbVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZVt3cmFwKHkgKyAxLCBtYXhZKV1beF0gPT09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bU9mTGl2ZUNlbGxzKys7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vYm90dG9tIGxlZnRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGVbd3JhcCh5ICsgMSwgbWF4WSldW3dyYXAoeCAtIDEsIG1heFgpXSA9PT0gMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZMaXZlQ2VsbHMrKztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9sZWZ0XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlW3ldW3dyYXAoeCAtIDEsIG1heFgpXSA9PT0gMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgbnVtT2ZMaXZlQ2VsbHMrKztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bU9mTGl2ZUNlbGxzO1xyXG5cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAvLyNlbmRyZWdpb24gd3JhcCBhcm91bmRcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0U3RhdGUgPSBnZW5FbXB0eUFycmF5KHN0YXRlWzBdLmxlbmd0aCwgc3RhdGUubGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHN0YXRlLmxlbmd0aDsgeSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgc3RhdGVbMF0ubGVuZ3RoOyB4KyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9nUG9wID0gc3RhdGVbeV1beF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bU9mTGl2ZUNlbGxzTmVhcmJ5ID0gc2hvdWxkV3JhcCA/IGdldE5lYXJieVBvcHVsYXRpb25XcmFwKHgsIHkpIDogZ2V0TmVhcmJ5UG9wdWxhdGlvbk5vV3JhcCh4LCB5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5ld1BvcDogbnVtYmVyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9nUG9wID09PSAwIHx8IG9nUG9wID09PSAtMSkgLy9pZiB0aGUgY2VsbCBpcyBkZWFkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdQb3AgPSAobnVtT2ZMaXZlQ2VsbHNOZWFyYnkgPT09IDMpID8gMSA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9nUG9wID09PSAxKSAvL2lmIHRoZSBjZWxsIGlzIGxpdmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1BvcCA9IChudW1PZkxpdmVDZWxsc05lYXJieSA9PT0gMiB8fCBudW1PZkxpdmVDZWxsc05lYXJieSA9PT0gMykgPyAxIDogMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRUcmFjZSAmJiBuZXdQb3AgPT09IDAgJiYgKG9nUG9wID09PSAtMSB8fCBvZ1BvcCA9PT0gMSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdQb3AgPSAtMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRTdGF0ZVt5XVt4XSA9IG5ld1BvcDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZURhdGFNYXA6IFN0YXRlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IG5leHRTdGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICBtYXA6IGdldEFsZ29yaXRobUNvbG9yTWFwKFwiQ29ud2F5XCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIHRyYWNlTnVtYmVyOiBzaG91bGRUcmFjZSA/IC0xIDogbnVsbFxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVEYXRhTWFwO1xyXG5cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAoY2VsbHVsYXJBdXRvbWF0b24pIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiQ29ud2F5XCI6XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb253YXkoc3RhdGUpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldEFsZ29yaXRobUNvbG9yTWFwOiBnZXRBbGdvcml0aG1Db2xvck1hcFxyXG5cclxuICAgIH07XHJcblxyXG59KSgpOyJdfQ==